module.exports = [
"[project]/apps/admin-app/.next-internal/server/app/api/admin/dashboard/route/actions.js [app-rsc] (server actions loader, ecmascript)", ((__turbopack_context__, module, exports) => {

}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/action-async-storage.external.js [external] (next/dist/server/app-render/action-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/action-async-storage.external.js", () => require("next/dist/server/app-render/action-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/firebase-admin/app [external] (firebase-admin/app, esm_import)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

const mod = await __turbopack_context__.y("firebase-admin/app");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[externals]/firebase-admin/auth [external] (firebase-admin/auth, esm_import)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

const mod = await __turbopack_context__.y("firebase-admin/auth");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[externals]/firebase-admin/firestore [external] (firebase-admin/firestore, esm_import)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

const mod = await __turbopack_context__.y("firebase-admin/firestore");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[externals]/firebase-admin/storage [external] (firebase-admin/storage, esm_import)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

const mod = await __turbopack_context__.y("firebase-admin/storage");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[project]/apps/admin-app/src/lib/firebase-admin.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

__turbopack_context__.s([
    "adminAuth",
    ()=>adminAuth,
    "adminDb",
    ()=>adminDb,
    "adminStorage",
    ()=>adminStorage,
    "default",
    ()=>__TURBOPACK__default__export__
]);
var __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/firebase-admin/app [external] (firebase-admin/app, esm_import)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$auth__$5b$external$5d$__$28$firebase$2d$admin$2f$auth$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/firebase-admin/auth [external] (firebase-admin/auth, esm_import)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/firebase-admin/firestore [external] (firebase-admin/firestore, esm_import)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$storage__$5b$external$5d$__$28$firebase$2d$admin$2f$storage$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/firebase-admin/storage [external] (firebase-admin/storage, esm_import)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__,
    __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$auth__$5b$external$5d$__$28$firebase$2d$admin$2f$auth$2c$__esm_import$29$__,
    __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__,
    __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$storage__$5b$external$5d$__$28$firebase$2d$admin$2f$storage$2c$__esm_import$29$__
]);
[__TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$auth__$5b$external$5d$__$28$firebase$2d$admin$2f$auth$2c$__esm_import$29$__, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$storage__$5b$external$5d$__$28$firebase$2d$admin$2f$storage$2c$__esm_import$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__;
;
;
;
;
// Initialize Firebase Admin
const privateKey = process.env.FIREBASE_PRIVATE_KEY?.replace(/^"|"$/g, '') || '';
const firebaseAdminConfig = {
    credential: (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__["cert"])({
        projectId: process.env.FIREBASE_PROJECT_ID,
        clientEmail: process.env.FIREBASE_CLIENT_EMAIL,
        privateKey: privateKey
    })
};
// Initialize Firebase Admin
const adminApp = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__["getApps"])().length === 0 ? (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__["initializeApp"])(firebaseAdminConfig) : (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__["getApps"])()[0];
const adminAuth = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$auth__$5b$external$5d$__$28$firebase$2d$admin$2f$auth$2c$__esm_import$29$__["getAuth"])(adminApp);
const adminDb = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__["getFirestore"])(adminApp);
const adminStorage = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$storage__$5b$external$5d$__$28$firebase$2d$admin$2f$storage$2c$__esm_import$29$__["getStorage"])(adminApp);
const __TURBOPACK__default__export__ = adminApp;
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
"[project]/apps/admin-app/src/lib/admin-auth.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

__turbopack_context__.s([
    "getQueryParams",
    ()=>getQueryParams,
    "verifyAdminAuth",
    ()=>verifyAdminAuth
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/headers.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/admin-app/src/lib/firebase-admin.ts [app-route] (ecmascript)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__
]);
[__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__;
;
;
async function verifyAdminAuth() {
    try {
        const cookieStore = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["cookies"])();
        const token = cookieStore.get('admin-token')?.value;
        // For development, we'll allow access with a simple token check
        if (token === 'dev_admin_token') {
            return {
                adminId: "dev_admin",
                name: "Development Admin",
                email: "admin@docuploaer.com",
                role: "admin"
            };
        }
        if (!token) {
            throw new Error('No admin authentication token found');
        }
        // Verify the token with Firebase Admin
        const decodedToken = await __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminAuth"].verifyIdToken(token);
        // Check if this is a custom token with admin role
        if (decodedToken.role === 'admin') {
            return {
                adminId: decodedToken.adminId || decodedToken.uid,
                name: decodedToken.name || 'Admin',
                email: decodedToken.email || 'admin@example.com',
                role: "admin"
            };
        }
        // Get admin data from admins collection
        const adminDoc = await __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('admins').doc(decodedToken.uid).get();
        if (!adminDoc.exists) {
            throw new Error('Admin not found in database');
        }
        const adminData = adminDoc.data();
        if (!adminData?.isActive) {
            throw new Error('Admin account is deactivated');
        }
        return {
            adminId: decodedToken.uid,
            name: adminData.name,
            email: adminData.email,
            role: "admin"
        };
    } catch (error) {
        // For development, return default admin even on error
        return {
            adminId: "dev_admin",
            name: "Development Admin",
            email: "admin@docuploaer.com",
            role: "admin"
        };
    }
}
function getQueryParams(request) {
    const { searchParams } = new URL(request.url);
    return {
        filter: searchParams.get('filter') || 'all',
        dateFilter: searchParams.get('dateFilter') || 'all',
        search: searchParams.get('search') || '',
        limit: parseInt(searchParams.get('limit') || '50'),
        offset: parseInt(searchParams.get('offset') || '0'),
        status: searchParams.get('status'),
        userId: searchParams.get('userId'),
        fileId: searchParams.get('fileId'),
        startDate: searchParams.get('startDate'),
        endDate: searchParams.get('endDate')
    };
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
"[project]/apps/admin-app/src/app/api/admin/dashboard/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

__turbopack_context__.s([
    "GET",
    ()=>GET
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/admin-app/src/lib/firebase-admin.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/admin-app/src/lib/admin-auth.ts [app-route] (ecmascript)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__,
    __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__
]);
[__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__;
;
;
;
// Helper function to handle Firestore connection issues with retry logic
async function withRetry(operation, maxRetries = 3, delay = 1000) {
    let lastError;
    for(let attempt = 1; attempt <= maxRetries; attempt++){
        try {
            return await operation();
        } catch (error) {
            lastError = error;
            // Check if it's a connection error that we should retry
            if (error.code === 14 || // UNAVAILABLE
            error.message?.includes('No connection established') || error.message?.includes('network socket disconnected') || error.message?.includes('TLS connection') || error.code === 'ECONNRESET' || error.code === 'ENOTFOUND') {
                console.log(`[RETRY] Attempt ${attempt}/${maxRetries} failed, retrying in ${delay}ms...`);
                if (attempt < maxRetries) {
                    await new Promise((resolve)=>setTimeout(resolve, delay));
                    delay *= 2; // Exponential backoff
                    continue;
                }
            }
            // If it's not a retryable error or we've exhausted retries, throw
            throw error;
        }
    }
    throw lastError;
}
async function GET(request) {
    try {
        // Verify admin authentication
        const admin = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["verifyAdminAuth"])();
        // Ensure only admin role can access this endpoint
        if (admin.role !== 'admin') {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                message: "Admin access required"
            }, {
                status: 403
            });
        }
        const { searchParams } = new URL(request.url);
        const period = searchParams.get('period') || '30d'; // '7d', '30d', '90d', '1y'
        // Calculate date range
        const endDate = new Date();
        const startDate = new Date();
        switch(period){
            case '7d':
                startDate.setDate(endDate.getDate() - 7);
                break;
            case '30d':
                startDate.setDate(endDate.getDate() - 30);
                break;
            case '90d':
                startDate.setDate(endDate.getDate() - 90);
                break;
            case '1y':
                startDate.setFullYear(endDate.getFullYear() - 1);
                break;
            default:
                startDate.setDate(endDate.getDate() - 30);
        }
        // Get all data in parallel with retry logic (avoiding composite indexes)
        const [allUsersSnapshot, filesSnapshot, paymentsSnapshot, logsSnapshot] = await Promise.all([
            // All users (we'll filter by role in code)
            withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('users').get()).catch(()=>({
                    docs: [],
                    size: 0
                })),
            // Files
            withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('files').get()).catch(()=>({
                    docs: [],
                    size: 0
                })),
            // Payments
            withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('payments').get()).catch(()=>({
                    docs: [],
                    size: 0
                })),
            // Recent logs (simplified query)
            withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('logs').orderBy('timestamp', 'desc').limit(100).get()).catch(()=>({
                    docs: [],
                    size: 0
                }))
        ]);
        // Filter users by role
        const usersSnapshot = {
            docs: allUsersSnapshot.docs.filter((doc)=>doc.data().role === 'user'),
            size: allUsersSnapshot.docs.filter((doc)=>doc.data().role === 'user').length
        };
        const agentsSnapshot = {
            docs: allUsersSnapshot.docs.filter((doc)=>doc.data().role === 'agent'),
            size: allUsersSnapshot.docs.filter((doc)=>doc.data().role === 'agent').length
        };
        // Process users data
        const totalUsers = usersSnapshot.size;
        const activeUsers = usersSnapshot.docs.filter((doc)=>doc.data().isActive).length;
        const newUsers = usersSnapshot.docs.filter((doc)=>{
            const createdAt = doc.data().createdAt?.toDate?.() || doc.data().createdAt;
            return createdAt >= startDate;
        }).length;
        // Process agents data
        const totalAgents = agentsSnapshot.size;
        const activeAgents = agentsSnapshot.docs.filter((doc)=>doc.data().isActive).length;
        const newAgents = agentsSnapshot.docs.filter((doc)=>{
            const createdAt = doc.data().createdAt?.toDate?.() || doc.data().createdAt;
            return createdAt >= startDate;
        }).length;
        // Process files data
        const totalFiles = filesSnapshot.size;
        const filesByStatus = filesSnapshot.docs.reduce((acc, doc)=>{
            const status = doc.data().status;
            acc[status] = (acc[status] || 0) + 1;
            return acc;
        }, {});
        const newFiles = filesSnapshot.docs.filter((doc)=>{
            const uploadedAt = doc.data().uploadedAt?.toDate?.() || doc.data().uploadedAt;
            return uploadedAt >= startDate;
        }).length;
        const unassignedFiles = filesSnapshot.docs.filter((doc)=>doc.data().status === 'paid' && !doc.data().assignedAgentId).length;
        // Process payments data
        const totalPayments = paymentsSnapshot.size;
        const successfulPayments = paymentsSnapshot.docs.filter((doc)=>doc.data().status === 'captured').length;
        const totalRevenue = paymentsSnapshot.docs.filter((doc)=>doc.data().status === 'captured').reduce((sum, doc)=>sum + (doc.data().amount || 0), 0);
        const newPayments = paymentsSnapshot.docs.filter((doc)=>{
            const createdAt = doc.data().createdAt?.toDate?.() || doc.data().createdAt;
            return createdAt >= startDate;
        }).length;
        const newRevenue = paymentsSnapshot.docs.filter((doc)=>{
            const createdAt = doc.data().createdAt?.toDate?.() || doc.data().createdAt;
            return createdAt >= startDate && doc.data().status === 'captured';
        }).reduce((sum, doc)=>sum + (doc.data().amount || 0), 0);
        // Process logs for activity insights
        const recentActivity = logsSnapshot.docs.slice(0, 10).map((doc)=>{
            const data = doc.data();
            return {
                id: doc.id,
                actionType: data.actionType,
                actorId: data.actorId,
                actorType: data.actorType,
                timestamp: data.timestamp?.toDate?.() || data.timestamp,
                details: data.details || {}
            };
        });
        // Calculate success rates
        const paymentSuccessRate = totalPayments > 0 ? (successfulPayments / totalPayments * 100).toFixed(2) : 0;
        const fileCompletionRate = totalFiles > 0 ? ((filesByStatus.completed || 0) / totalFiles * 100).toFixed(2) : 0;
        // Get agent performance data
        const agentPerformance = await Promise.all(agentsSnapshot.docs.map(async (agentDoc)=>{
            const agentData = agentDoc.data();
            const agentId = agentDoc.id;
            const agentFilesSnapshot = await withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('files').where('assignedAgentId', '==', agentId).get());
            const completedFiles = agentFilesSnapshot.docs.filter((doc)=>doc.data().status === 'completed').length;
            const pendingFiles = agentFilesSnapshot.docs.filter((doc)=>doc.data().status === 'paid' || doc.data().status === 'processing').length;
            return {
                id: agentId,
                name: agentData.name,
                email: agentData.email,
                totalFiles: agentFilesSnapshot.size,
                completedFiles,
                pendingFiles,
                completionRate: agentFilesSnapshot.size > 0 ? (completedFiles / agentFilesSnapshot.size * 100).toFixed(2) : 0
            };
        }));
        // Get daily statistics for charts
        const dailyStats = await getDailyStats(startDate, endDate).catch(()=>[]);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            period,
            overview: {
                totalUsers,
                activeUsers,
                newUsers,
                totalAgents,
                activeAgents,
                newAgents,
                totalFiles,
                newFiles,
                unassignedFiles,
                totalPayments,
                successfulPayments,
                newPayments,
                totalRevenue,
                newRevenue
            },
            files: {
                total: totalFiles,
                byStatus: filesByStatus,
                new: newFiles,
                unassigned: unassignedFiles,
                completionRate: fileCompletionRate
            },
            payments: {
                total: totalPayments,
                successful: successfulPayments,
                new: newPayments,
                totalRevenue,
                newRevenue,
                successRate: paymentSuccessRate
            },
            agents: {
                total: totalAgents,
                active: activeAgents,
                new: newAgents,
                performance: agentPerformance
            },
            activity: {
                recent: recentActivity,
                dailyStats
            }
        });
    } catch (error) {
        console.error("Error fetching dashboard data:", error);
        // Handle specific error types
        if (error.code === 14 || error.message?.includes('No connection established')) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                message: "Database connection failed. Please try again."
            }, {
                status: 503
            });
        }
        if (error.name === 'AbortError' || error.message?.includes('timeout')) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                message: "Request timed out. Please try again."
            }, {
                status: 408
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            message: "Failed to fetch dashboard data"
        }, {
            status: 500
        });
    }
}
// Helper function to get daily statistics (NO COMPOSITE INDEXES)
async function getDailyStats(startDate, endDate) {
    const dailyData = {};
    // Initialize all days in range
    for(let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)){
        const dateKey = d.toISOString().split('T')[0];
        dailyData[dateKey] = {
            date: dateKey,
            files: 0,
            payments: 0,
            revenue: 0,
            users: 0
        };
    }
    try {
        // Get all files and filter by date range (NO INDEX REQUIRED)
        const filesSnapshot = await withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('files').get()).catch(()=>({
                docs: []
            }));
        filesSnapshot.docs.forEach((doc)=>{
            const uploadedAt = doc.data().uploadedAt?.toDate?.() || doc.data().uploadedAt;
            if (uploadedAt && uploadedAt >= startDate && uploadedAt <= endDate) {
                const dateKey = uploadedAt.toISOString().split('T')[0];
                if (dailyData[dateKey]) {
                    dailyData[dateKey].files++;
                }
            }
        });
        // Get all payments and filter by date range (NO INDEX REQUIRED)
        const paymentsSnapshot = await withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('payments').get()).catch(()=>({
                docs: []
            }));
        paymentsSnapshot.docs.forEach((doc)=>{
            const createdAt = doc.data().createdAt?.toDate?.() || doc.data().createdAt;
            if (createdAt && createdAt >= startDate && createdAt <= endDate) {
                const dateKey = createdAt.toISOString().split('T')[0];
                if (dailyData[dateKey]) {
                    dailyData[dateKey].payments++;
                    if (doc.data().status === 'captured') {
                        dailyData[dateKey].revenue += doc.data().amount || 0;
                    }
                }
            }
        });
        // Get all users and filter by role and date range (NO INDEX REQUIRED)
        const usersSnapshot = await withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('users').get()).catch(()=>({
                docs: []
            }));
        usersSnapshot.docs.forEach((doc)=>{
            const userData = doc.data();
            if (userData.role === 'user') {
                const createdAt = userData.createdAt?.toDate?.() || userData.createdAt;
                if (createdAt && createdAt >= startDate && createdAt <= endDate) {
                    const dateKey = createdAt.toISOString().split('T')[0];
                    if (dailyData[dateKey]) {
                        dailyData[dateKey].users++;
                    }
                }
            }
        });
    } catch (error) {
        console.error('Error fetching daily stats:', error);
    // Return empty data if there's an error
    }
    return Object.values(dailyData).sort((a, b)=>a.date.localeCompare(b.date));
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__605596cf._.js.map