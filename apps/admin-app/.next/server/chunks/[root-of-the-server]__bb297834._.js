module.exports = [
"[project]/apps/admin-app/.next-internal/server/app/api/admin/assign/route/actions.js [app-rsc] (server actions loader, ecmascript)", ((__turbopack_context__, module, exports) => {

}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/action-async-storage.external.js [external] (next/dist/server/app-render/action-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/action-async-storage.external.js", () => require("next/dist/server/app-render/action-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/firebase-admin/app [external] (firebase-admin/app, esm_import)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

const mod = await __turbopack_context__.y("firebase-admin/app");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[externals]/firebase-admin/auth [external] (firebase-admin/auth, esm_import)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

const mod = await __turbopack_context__.y("firebase-admin/auth");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[externals]/firebase-admin/firestore [external] (firebase-admin/firestore, esm_import)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

const mod = await __turbopack_context__.y("firebase-admin/firestore");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[externals]/firebase-admin/storage [external] (firebase-admin/storage, esm_import)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

const mod = await __turbopack_context__.y("firebase-admin/storage");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[project]/apps/admin-app/src/lib/firebase-admin.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

__turbopack_context__.s([
    "adminAuth",
    ()=>adminAuth,
    "adminDb",
    ()=>adminDb,
    "adminStorage",
    ()=>adminStorage,
    "default",
    ()=>__TURBOPACK__default__export__
]);
var __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/firebase-admin/app [external] (firebase-admin/app, esm_import)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$auth__$5b$external$5d$__$28$firebase$2d$admin$2f$auth$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/firebase-admin/auth [external] (firebase-admin/auth, esm_import)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/firebase-admin/firestore [external] (firebase-admin/firestore, esm_import)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$storage__$5b$external$5d$__$28$firebase$2d$admin$2f$storage$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/firebase-admin/storage [external] (firebase-admin/storage, esm_import)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__,
    __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$auth__$5b$external$5d$__$28$firebase$2d$admin$2f$auth$2c$__esm_import$29$__,
    __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__,
    __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$storage__$5b$external$5d$__$28$firebase$2d$admin$2f$storage$2c$__esm_import$29$__
]);
[__TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$auth__$5b$external$5d$__$28$firebase$2d$admin$2f$auth$2c$__esm_import$29$__, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$storage__$5b$external$5d$__$28$firebase$2d$admin$2f$storage$2c$__esm_import$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__;
;
;
;
;
// Initialize Firebase Admin
// Handle both true multiline and "\n"-escaped private keys
const privateKey = (process.env.FIREBASE_PRIVATE_KEY || '').replace(/^"|"$/g, '').replace(/\\n/g, '\n');
const firebaseAdminConfig = {
    credential: (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__["cert"])({
        projectId: process.env.FIREBASE_PROJECT_ID,
        clientEmail: process.env.FIREBASE_CLIENT_EMAIL,
        privateKey: privateKey
    })
};
// Initialize Firebase Admin
const adminApp = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__["getApps"])().length === 0 ? (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__["initializeApp"])(firebaseAdminConfig) : (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__["getApps"])()[0];
const adminAuth = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$auth__$5b$external$5d$__$28$firebase$2d$admin$2f$auth$2c$__esm_import$29$__["getAuth"])(adminApp);
const adminDb = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__["getFirestore"])(adminApp);
const adminStorage = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$storage__$5b$external$5d$__$28$firebase$2d$admin$2f$storage$2c$__esm_import$29$__["getStorage"])(adminApp);
const __TURBOPACK__default__export__ = adminApp;
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
"[project]/apps/admin-app/src/lib/admin-auth.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

__turbopack_context__.s([
    "getQueryParams",
    ()=>getQueryParams,
    "verifyAdminAuth",
    ()=>verifyAdminAuth
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/headers.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/admin-app/src/lib/firebase-admin.ts [app-route] (ecmascript)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__
]);
[__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__;
;
;
async function verifyAdminAuth() {
    try {
        const cookieStore = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["cookies"])();
        const token = cookieStore.get('admin-token')?.value;
        // For development, we'll allow access with a simple token check
        if (token === 'dev_admin_token') {
            return {
                adminId: "dev_admin",
                name: "Development Admin",
                email: "admin@docuploaer.com",
                role: "admin"
            };
        }
        if (!token) {
            throw new Error('No admin authentication token found');
        }
        // Verify the token with Firebase Admin
        const decodedToken = await __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminAuth"].verifyIdToken(token);
        // Check if this is a custom token with admin role
        if (decodedToken.role === 'admin') {
            return {
                adminId: decodedToken.adminId || decodedToken.uid,
                name: decodedToken.name || 'Admin',
                email: decodedToken.email || 'admin@example.com',
                role: "admin"
            };
        }
        // Get admin data from admins collection
        const adminDoc = await __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('admins').doc(decodedToken.uid).get();
        if (!adminDoc.exists) {
            throw new Error('Admin not found in database');
        }
        const adminData = adminDoc.data();
        if (!adminData?.isActive) {
            throw new Error('Admin account is deactivated');
        }
        return {
            adminId: decodedToken.uid,
            name: adminData.name,
            email: adminData.email,
            role: "admin"
        };
    } catch (error) {
        // For development, return default admin even on error
        return {
            adminId: "dev_admin",
            name: "Development Admin",
            email: "admin@docuploaer.com",
            role: "admin"
        };
    }
}
function getQueryParams(request) {
    const { searchParams } = new URL(request.url);
    return {
        filter: searchParams.get('filter') || 'all',
        dateFilter: searchParams.get('dateFilter') || 'all',
        search: searchParams.get('search') || '',
        limit: parseInt(searchParams.get('limit') || '50'),
        offset: parseInt(searchParams.get('offset') || '0'),
        status: searchParams.get('status'),
        userId: searchParams.get('userId'),
        fileId: searchParams.get('fileId'),
        startDate: searchParams.get('startDate'),
        endDate: searchParams.get('endDate')
    };
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
"[project]/apps/admin-app/src/lib/server-cache.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "makeKey",
    ()=>makeKey,
    "serverCache",
    ()=>serverCache
]);
class SimpleLRUCache {
    maxEntries;
    store;
    order;
    constructor(maxEntries = 200){
        this.maxEntries = maxEntries;
        this.store = new Map();
        this.order = [];
    }
    get(key) {
        const entry = this.store.get(key);
        if (!entry) return undefined;
        if (Date.now() > entry.expiresAt) {
            this.delete(key);
            return undefined;
        }
        // touch
        this.order = this.order.filter((k)=>k !== key);
        this.order.push(key);
        return entry.data;
    }
    set(key, value, ttlMs) {
        const expiresAt = Date.now() + ttlMs;
        this.store.set(key, {
            data: value,
            expiresAt
        });
        this.order = this.order.filter((k)=>k !== key);
        this.order.push(key);
        // evict
        while(this.order.length > this.maxEntries){
            const oldest = this.order.shift();
            if (oldest) this.store.delete(oldest);
        }
    }
    delete(key) {
        this.store.delete(key);
        this.order = this.order.filter((k)=>k !== key);
    }
    deleteByPrefix(prefix) {
        for (const key of Array.from(this.store.keys())){
            if (key.startsWith(prefix)) this.delete(key);
        }
    }
}
const serverCache = new SimpleLRUCache(300);
function makeKey(resource, parts = []) {
    return `admin:${resource}:${parts.filter((v)=>v !== undefined && v !== null).join(':')}`;
}
}),
"[project]/apps/admin-app/src/app/api/admin/assign/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

__turbopack_context__.s([
    "DELETE",
    ()=>DELETE,
    "GET",
    ()=>GET,
    "POST",
    ()=>POST,
    "PUT",
    ()=>PUT
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/admin-app/src/lib/firebase-admin.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/admin-app/src/lib/admin-auth.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/admin-app/src/lib/server-cache.ts [app-route] (ecmascript)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__,
    __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__
]);
[__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__;
;
;
;
;
async function GET(request) {
    try {
        // Verify admin authentication
        const admin = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["verifyAdminAuth"])();
        if (!admin) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: 'Unauthorized'
            }, {
                status: 401
            });
        }
        // Check cache
        const cacheKey = (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["makeKey"])('assign', [
            'stats'
        ]);
        const cached = __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["serverCache"].get(cacheKey);
        if (cached) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(cached);
        }
        // OPTIMIZED: Parallel queries with limits to prevent huge data fetches
        const [filesSnapshot, agentsSnapshot] = await Promise.all([
            __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('files').orderBy('uploadedAt', 'desc').limit(500) // Reduced limit for better performance
            .get(),
            __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('agents').limit(100) // Limit agents query
            .get()
        ]);
        // OPTIMIZED: Process data efficiently - extract only needed fields
        // Count assignments and build workload map in single pass
        let totalFiles = 0;
        let assignedFiles = 0;
        let unassignedFiles = 0;
        const workloadMap = new Map();
        filesSnapshot.docs.forEach((doc)=>{
            totalFiles++;
            const data = doc.data();
            const agentId = data.assignedAgentId;
            const status = data.status;
            if (agentId) {
                assignedFiles++;
                const current = workloadMap.get(agentId) || {
                    total: 0,
                    pending: 0,
                    completed: 0
                };
                current.total++;
                if (status === 'paid' || status === 'assigned') current.pending++;
                if (status === 'completed') current.completed++;
                workloadMap.set(agentId, current);
            } else {
                unassignedFiles++;
            }
        });
        // Build agent workload array - only extract needed fields
        const agentWorkload = agentsSnapshot.docs.map((doc)=>{
            const data = doc.data();
            const workload = workloadMap.get(doc.id) || {
                total: 0,
                pending: 0,
                completed: 0
            };
            return {
                agentId: doc.id,
                agentName: data.name || 'Unknown',
                totalFiles: workload.total,
                pendingFiles: workload.pending,
                completedFiles: workload.completed
            };
        });
        const responsePayload = {
            success: true,
            data: {
                totalFiles,
                assignedFiles,
                unassignedFiles,
                agentWorkload
            }
        };
        // OPTIMIZED: Cache for 2 minutes (consistent with other sections)
        __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["serverCache"].set(cacheKey, responsePayload, 120_000);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(responsePayload);
    } catch (error) {
        console.error('Error fetching assignment stats:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: 'Failed to fetch assignment statistics'
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        // Verify admin authentication
        const admin = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["verifyAdminAuth"])();
        if (!admin) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: 'Unauthorized'
            }, {
                status: 401
            });
        }
        const { fileIds, agentId, assignmentType } = await request.json();
        if (!fileIds || !agentId) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: 'File IDs and Agent ID are required'
            }, {
                status: 400
            });
        }
        // Handle both single fileId and array of fileIds
        const filesToAssign = Array.isArray(fileIds) ? fileIds : [
            fileIds
        ];
        // Verify agent exists
        const agentDoc = await __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('agents').doc(agentId).get();
        if (!agentDoc.exists) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: 'Agent not found'
            }, {
                status: 404
            });
        }
        const agentData = agentDoc.data();
        // OPTIMIZED: Use batched writes for better performance
        const maxBatchSize = 500; // Firestore batch limit
        let processedCount = 0;
        for(let i = 0; i < filesToAssign.length; i += maxBatchSize){
            const batchFiles = filesToAssign.slice(i, Math.min(i + maxBatchSize, filesToAssign.length));
            const batch = __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].batch();
            batchFiles.forEach((fileId)=>{
                const fileRef = __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('files').doc(fileId);
                batch.update(fileRef, {
                    assignedAgentId: agentId,
                    assignedAt: new Date(),
                    status: 'assigned',
                    updatedAt: new Date()
                });
            });
            await batch.commit();
            processedCount += batchFiles.length;
        }
        // OPTIMIZED: Parallel logging and cache clearing
        await Promise.all([
            __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('logs').add({
                action: 'file_assigned',
                adminId: admin.adminId,
                adminName: admin.name,
                fileIds: filesToAssign,
                agentId,
                agentName: agentData?.name || 'Unknown',
                assignmentType: assignmentType || 'manual',
                timestamp: new Date()
            }),
            Promise.resolve().then(()=>{
                __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["serverCache"].deleteByPrefix((0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["makeKey"])('assign'));
                __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["serverCache"].deleteByPrefix((0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["makeKey"])('files'));
            })
        ]);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            message: `Successfully assigned ${filesToAssign.length} file(s) to agent`,
            assignedCount: filesToAssign.length
        });
    } catch (error) {
        console.error('Error assigning file:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: 'Failed to assign file'
        }, {
            status: 500
        });
    }
}
async function DELETE(request) {
    try {
        // Verify admin authentication
        const admin = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["verifyAdminAuth"])();
        if (!admin) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: 'Unauthorized'
            }, {
                status: 401
            });
        }
        const { fileId } = await request.json();
        if (!fileId) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: 'File ID is required'
            }, {
                status: 400
            });
        }
        // OPTIMIZED: Parallel operations for update and logging
        await Promise.all([
            __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('files').doc(fileId).update({
                assignedAgentId: null,
                assignedAt: null,
                updatedAt: new Date()
            }),
            __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('logs').add({
                action: 'file_unassigned',
                adminId: admin.adminId,
                adminName: admin.name,
                fileId,
                timestamp: new Date()
            })
        ]);
        // Clear cache
        __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["serverCache"].deleteByPrefix((0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["makeKey"])('assign'));
        __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["serverCache"].deleteByPrefix((0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["makeKey"])('files'));
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            message: 'File unassigned successfully'
        });
    } catch (error) {
        console.error('Error unassigning file:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: 'Failed to unassign file'
        }, {
            status: 500
        });
    }
}
async function PUT(request) {
    try {
        // Verify admin authentication
        const admin = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["verifyAdminAuth"])();
        if (!admin) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: 'Unauthorized'
            }, {
                status: 401
            });
        }
        const { type = 'round_robin' } = await request.json();
        // OPTIMIZED: Fetch both queries in parallel with limits
        const [unassignedFilesSnapshot, agentsSnapshot] = await Promise.all([
            __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('files').where('status', '==', 'paid').where('assignedAgentId', '==', null).limit(1000) // Limit to prevent huge queries
            .get(),
            __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('agents').where('isActive', '==', true).limit(100) // Limit agents query
            .get()
        ]);
        if (unassignedFilesSnapshot.empty) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: true,
                message: 'No unassigned files found',
                assignedCount: 0
            });
        }
        if (agentsSnapshot.empty) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: 'No active agents found'
            }, {
                status: 400
            });
        }
        // OPTIMIZED: Extract only needed agent fields
        const agents = agentsSnapshot.docs.map((doc)=>({
                id: doc.id,
                name: doc.data().name,
                maxWorkload: doc.data().maxWorkload || 20
            }));
        const unassignedFiles = unassignedFilesSnapshot.docs;
        let assignedCount = 0;
        const assignmentPlan = [];
        if (type === 'round_robin') {
            // OPTIMIZED: Calculate assignments first, then batch write
            for(let i = 0; i < unassignedFiles.length; i++){
                const file = unassignedFiles[i];
                const agent = agents[i % agents.length];
                assignmentPlan.push({
                    fileId: file.id,
                    agentId: agent.id
                });
            }
        } else if (type === 'load_balanced') {
            // OPTIMIZED: Batch query for current workload with limits
            const agentWorkload = new Map();
            // Initialize workload for each agent
            agents.forEach((agent)=>{
                agentWorkload.set(agent.id, 0);
            });
            // OPTIMIZED: Single query to get current assignments with limit
            const agentIds = agents.map((a)=>a.id);
            // Handle Firestore 'in' query limit of 10 items
            for(let i = 0; i < agentIds.length; i += 10){
                const batchIds = agentIds.slice(i, Math.min(i + 10, agentIds.length));
                const batchSnapshot = await __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('files').where('assignedAgentId', 'in', batchIds).where('status', 'in', [
                    'paid',
                    'assigned',
                    'in_progress'
                ]).limit(1000) // Limit to prevent huge queries
                .get();
                batchSnapshot.docs.forEach((doc)=>{
                    const data = doc.data();
                    if (data.assignedAgentId) {
                        agentWorkload.set(data.assignedAgentId, (agentWorkload.get(data.assignedAgentId) || 0) + 1);
                    }
                });
            }
            // Calculate load-balanced assignments
            for (const file of unassignedFiles){
                const leastLoadedAgent = Array.from(agentWorkload.entries()).reduce((min, current)=>current[1] < min[1] ? current : min);
                assignmentPlan.push({
                    fileId: file.id,
                    agentId: leastLoadedAgent[0]
                });
                // Update workload count for next iteration
                agentWorkload.set(leastLoadedAgent[0], leastLoadedAgent[1] + 1);
            }
        }
        // OPTIMIZED: Use batch writes for all assignments
        const maxBatchSize = 500; // Firestore batch limit
        for(let i = 0; i < assignmentPlan.length; i += maxBatchSize){
            const batchPlan = assignmentPlan.slice(i, Math.min(i + maxBatchSize, assignmentPlan.length));
            const batch = __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].batch();
            batchPlan.forEach(({ fileId, agentId })=>{
                const fileRef = __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('files').doc(fileId);
                batch.update(fileRef, {
                    assignedAgentId: agentId,
                    assignedAt: new Date(),
                    status: 'assigned',
                    updatedAt: new Date()
                });
            });
            await batch.commit();
            assignedCount += batchPlan.length;
        }
        // Log the action (parallel with cache clear)
        await Promise.all([
            __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('logs').add({
                action: 'bulk_assignment',
                adminId: admin.adminId,
                adminName: admin.name,
                assignmentType: type,
                assignedCount,
                timestamp: new Date()
            }),
            // Clear cache
            Promise.resolve().then(()=>{
                __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["serverCache"].deleteByPrefix((0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["makeKey"])('assign'));
                __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["serverCache"].deleteByPrefix((0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["makeKey"])('files'));
            })
        ]);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            message: `Successfully assigned ${assignedCount} files using ${type} method`,
            assignedCount
        });
    } catch (error) {
        console.error('Error performing bulk assignment:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: 'Failed to perform bulk assignment'
        }, {
            status: 500
        });
    }
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__bb297834._.js.map