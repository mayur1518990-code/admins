module.exports = [
"[project]/apps/admin-app/.next-internal/server/app/api/admin/dashboard/route/actions.js [app-rsc] (server actions loader, ecmascript)", ((__turbopack_context__, module, exports) => {

}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/action-async-storage.external.js [external] (next/dist/server/app-render/action-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/action-async-storage.external.js", () => require("next/dist/server/app-render/action-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/firebase-admin/app [external] (firebase-admin/app, esm_import)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

const mod = await __turbopack_context__.y("firebase-admin/app");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[externals]/firebase-admin/auth [external] (firebase-admin/auth, esm_import)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

const mod = await __turbopack_context__.y("firebase-admin/auth");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[externals]/firebase-admin/firestore [external] (firebase-admin/firestore, esm_import)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

const mod = await __turbopack_context__.y("firebase-admin/firestore");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[externals]/firebase-admin/storage [external] (firebase-admin/storage, esm_import)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

const mod = await __turbopack_context__.y("firebase-admin/storage");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[project]/apps/admin-app/src/lib/firebase-admin.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

__turbopack_context__.s([
    "adminAuth",
    ()=>adminAuth,
    "adminDb",
    ()=>adminDb,
    "adminStorage",
    ()=>adminStorage,
    "default",
    ()=>__TURBOPACK__default__export__
]);
var __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/firebase-admin/app [external] (firebase-admin/app, esm_import)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$auth__$5b$external$5d$__$28$firebase$2d$admin$2f$auth$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/firebase-admin/auth [external] (firebase-admin/auth, esm_import)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/firebase-admin/firestore [external] (firebase-admin/firestore, esm_import)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$storage__$5b$external$5d$__$28$firebase$2d$admin$2f$storage$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/firebase-admin/storage [external] (firebase-admin/storage, esm_import)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__,
    __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$auth__$5b$external$5d$__$28$firebase$2d$admin$2f$auth$2c$__esm_import$29$__,
    __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__,
    __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$storage__$5b$external$5d$__$28$firebase$2d$admin$2f$storage$2c$__esm_import$29$__
]);
[__TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$auth__$5b$external$5d$__$28$firebase$2d$admin$2f$auth$2c$__esm_import$29$__, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$storage__$5b$external$5d$__$28$firebase$2d$admin$2f$storage$2c$__esm_import$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__;
;
;
;
;
// Initialize Firebase Admin
// Handle both true multiline and "\n"-escaped private keys
const privateKey = (process.env.FIREBASE_PRIVATE_KEY || '').replace(/^"|"$/g, '').replace(/\\n/g, '\n');
const firebaseAdminConfig = {
    credential: (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__["cert"])({
        projectId: process.env.FIREBASE_PROJECT_ID,
        clientEmail: process.env.FIREBASE_CLIENT_EMAIL,
        privateKey: privateKey
    })
};
// Initialize Firebase Admin
const adminApp = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__["getApps"])().length === 0 ? (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__["initializeApp"])(firebaseAdminConfig) : (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$app__$5b$external$5d$__$28$firebase$2d$admin$2f$app$2c$__esm_import$29$__["getApps"])()[0];
const adminAuth = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$auth__$5b$external$5d$__$28$firebase$2d$admin$2f$auth$2c$__esm_import$29$__["getAuth"])(adminApp);
const adminDb = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__["getFirestore"])(adminApp);
const adminStorage = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$storage__$5b$external$5d$__$28$firebase$2d$admin$2f$storage$2c$__esm_import$29$__["getStorage"])(adminApp);
const __TURBOPACK__default__export__ = adminApp;
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
"[project]/apps/admin-app/src/lib/admin-auth.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

__turbopack_context__.s([
    "getQueryParams",
    ()=>getQueryParams,
    "verifyAdminAuth",
    ()=>verifyAdminAuth
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/headers.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/admin-app/src/lib/firebase-admin.ts [app-route] (ecmascript)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__
]);
[__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__;
;
;
async function verifyAdminAuth() {
    try {
        const cookieStore = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["cookies"])();
        const token = cookieStore.get('admin-token')?.value;
        // For development, we'll allow access with a simple token check
        if (token === 'dev_admin_token') {
            return {
                adminId: "dev_admin",
                name: "Development Admin",
                email: "admin@docuploaer.com",
                role: "admin"
            };
        }
        if (!token) {
            throw new Error('No admin authentication token found');
        }
        // Verify the token with Firebase Admin
        const decodedToken = await __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminAuth"].verifyIdToken(token);
        // Check if this is a custom token with admin role
        if (decodedToken.role === 'admin') {
            return {
                adminId: decodedToken.adminId || decodedToken.uid,
                name: decodedToken.name || 'Admin',
                email: decodedToken.email || 'admin@example.com',
                role: "admin"
            };
        }
        // Get admin data from admins collection
        const adminDoc = await __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('admins').doc(decodedToken.uid).get();
        if (!adminDoc.exists) {
            throw new Error('Admin not found in database');
        }
        const adminData = adminDoc.data();
        if (!adminData?.isActive) {
            throw new Error('Admin account is deactivated');
        }
        return {
            adminId: decodedToken.uid,
            name: adminData.name,
            email: adminData.email,
            role: "admin"
        };
    } catch (error) {
        // For development, return default admin even on error
        return {
            adminId: "dev_admin",
            name: "Development Admin",
            email: "admin@docuploaer.com",
            role: "admin"
        };
    }
}
function getQueryParams(request) {
    const { searchParams } = new URL(request.url);
    return {
        filter: searchParams.get('filter') || 'all',
        dateFilter: searchParams.get('dateFilter') || 'all',
        search: searchParams.get('search') || '',
        limit: parseInt(searchParams.get('limit') || '50'),
        offset: parseInt(searchParams.get('offset') || '0'),
        status: searchParams.get('status'),
        userId: searchParams.get('userId'),
        fileId: searchParams.get('fileId'),
        startDate: searchParams.get('startDate'),
        endDate: searchParams.get('endDate')
    };
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
"[project]/apps/admin-app/src/lib/server-cache.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "makeKey",
    ()=>makeKey,
    "serverCache",
    ()=>serverCache
]);
class SimpleLRUCache {
    maxEntries;
    store;
    order;
    constructor(maxEntries = 200){
        this.maxEntries = maxEntries;
        this.store = new Map();
        this.order = [];
    }
    get(key) {
        const entry = this.store.get(key);
        if (!entry) return undefined;
        if (Date.now() > entry.expiresAt) {
            this.delete(key);
            return undefined;
        }
        // touch
        this.order = this.order.filter((k)=>k !== key);
        this.order.push(key);
        return entry.data;
    }
    set(key, value, ttlMs) {
        const expiresAt = Date.now() + ttlMs;
        this.store.set(key, {
            data: value,
            expiresAt
        });
        this.order = this.order.filter((k)=>k !== key);
        this.order.push(key);
        // evict
        while(this.order.length > this.maxEntries){
            const oldest = this.order.shift();
            if (oldest) this.store.delete(oldest);
        }
    }
    delete(key) {
        this.store.delete(key);
        this.order = this.order.filter((k)=>k !== key);
    }
    deleteByPrefix(prefix) {
        for (const key of Array.from(this.store.keys())){
            if (key.startsWith(prefix)) this.delete(key);
        }
    }
}
const serverCache = new SimpleLRUCache(300);
function makeKey(resource, parts = []) {
    return `admin:${resource}:${parts.filter((v)=>v !== undefined && v !== null).join(':')}`;
}
}),
"[project]/apps/admin-app/src/app/api/admin/dashboard/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

__turbopack_context__.s([
    "GET",
    ()=>GET
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/admin-app/src/lib/firebase-admin.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/admin-app/src/lib/admin-auth.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/admin-app/src/lib/server-cache.ts [app-route] (ecmascript)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__,
    __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__
]);
[__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__;
;
;
;
;
// Helper function to handle Firestore connection issues with retry logic
async function withRetry(operation, maxRetries = 3, delay = 1000) {
    let lastError;
    for(let attempt = 1; attempt <= maxRetries; attempt++){
        try {
            return await operation();
        } catch (error) {
            lastError = error;
            // Check if it's a connection error that we should retry
            if (error.code === 14 || // UNAVAILABLE
            error.message?.includes('No connection established') || error.message?.includes('network socket disconnected') || error.message?.includes('TLS connection') || error.code === 'ECONNRESET' || error.code === 'ENOTFOUND') {
                // Retrying...
                if (attempt < maxRetries) {
                    await new Promise((resolve)=>setTimeout(resolve, delay));
                    delay *= 2; // Exponential backoff
                    continue;
                }
            }
            // If it's not a retryable error or we've exhausted retries, throw
            throw error;
        }
    }
    throw lastError;
}
async function GET(request) {
    try {
        // Verify admin authentication
        const admin = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$admin$2d$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["verifyAdminAuth"])();
        // Ensure only admin role can access this endpoint
        if (admin.role !== 'admin') {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                message: "Admin access required"
            }, {
                status: 403
            });
        }
        const { searchParams } = new URL(request.url);
        const period = searchParams.get('period') || '30d'; // '7d', '30d', '90d', '1y'
        // Check cache first
        const cacheKey = (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["makeKey"])('admin-dashboard', [
            period
        ]);
        const cached = __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["serverCache"].get(cacheKey);
        if (cached) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(cached);
        }
        // Calculate date range
        const endDate = new Date();
        const startDate = new Date();
        switch(period){
            case '7d':
                startDate.setDate(endDate.getDate() - 7);
                break;
            case '30d':
                startDate.setDate(endDate.getDate() - 30);
                break;
            case '90d':
                startDate.setDate(endDate.getDate() - 90);
                break;
            case '1y':
                startDate.setFullYear(endDate.getFullYear() - 1);
                break;
            default:
                startDate.setDate(endDate.getDate() - 30);
        }
        // OPTIMIZED: Use targeted queries with proper limits instead of fetching all data
        const [usersSnapshot, agentsSnapshot, adminsSnapshot, filesSnapshot, paymentsSnapshot, logsSnapshot] = await Promise.all([
            // Users only (with limit)
            withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('users').where('role', '==', 'user').limit(1000).get()).catch(()=>({
                    docs: [],
                    size: 0
                })),
            // Agents only (with limit)
            withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('agents').limit(100).get()).catch(()=>({
                    docs: [],
                    size: 0
                })),
            // Admins only (with limit)
            withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('admins').limit(50).get()).catch(()=>({
                    docs: [],
                    size: 0
                })),
            // Files with limit
            withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('files').orderBy('uploadedAt', 'desc').limit(1000).get()).catch(()=>({
                    docs: [],
                    size: 0
                })),
            // Payments with limit
            withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('payments').orderBy('createdAt', 'desc').limit(1000).get()).catch(()=>({
                    docs: [],
                    size: 0
                })),
            // Recent logs (already limited)
            withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('logs').orderBy('timestamp', 'desc').limit(100).get()).catch(()=>({
                    docs: [],
                    size: 0
                }))
        ]);
        // Data is already separated by collection, no need to filter
        // OPTIMIZATION: Single-pass data processing for all metrics
        // Initialize counters
        let totalUsers = 0, activeUsers = 0, newUsers = 0;
        let totalAgents = 0, activeAgents = 0, newAgents = 0;
        let totalFiles = 0, newFiles = 0, unassignedFiles = 0;
        let totalPayments = 0, successfulPayments = 0, newPayments = 0;
        let totalRevenue = 0, newRevenue = 0;
        const filesByStatus = {};
        // Process users and agents in single pass
        usersSnapshot.docs.forEach((doc)=>{
            const data = doc.data();
            const createdAt = data.createdAt?.toDate?.() || data.createdAt;
            const isNew = createdAt && createdAt >= startDate;
            totalUsers++;
            if (data.isActive) activeUsers++;
            if (isNew) newUsers++;
        });
        agentsSnapshot.docs.forEach((doc)=>{
            const data = doc.data();
            const createdAt = data.createdAt?.toDate?.() || data.createdAt;
            const isNew = createdAt && createdAt >= startDate;
            totalAgents++;
            if (data.isActive) activeAgents++;
            if (isNew) newAgents++;
        });
        // Process files in single pass
        filesSnapshot.docs.forEach((doc)=>{
            const data = doc.data();
            const uploadedAt = data.uploadedAt?.toDate?.() || data.uploadedAt;
            const isNew = uploadedAt && uploadedAt >= startDate;
            totalFiles++;
            if (isNew) newFiles++;
            if (data.status === 'paid' && !data.assignedAgentId) unassignedFiles++;
            // Count by status
            const status = data.status;
            filesByStatus[status] = (filesByStatus[status] || 0) + 1;
        });
        // Process payments in single pass
        paymentsSnapshot.docs.forEach((doc)=>{
            const data = doc.data();
            const createdAt = data.createdAt?.toDate?.() || data.createdAt;
            const isNew = createdAt && createdAt >= startDate;
            const isSuccessful = data.status === 'captured';
            totalPayments++;
            if (isSuccessful) {
                successfulPayments++;
                totalRevenue += data.amount || 0;
                if (isNew) newRevenue += data.amount || 0;
            }
            if (isNew) newPayments++;
        });
        // Process logs for activity insights
        const recentActivity = logsSnapshot.docs.slice(0, 10).map((doc)=>{
            const data = doc.data();
            return {
                id: doc.id,
                actionType: data.actionType,
                actorId: data.actorId,
                actorType: data.actorType,
                timestamp: data.timestamp?.toDate?.() || data.timestamp,
                details: data.details || {}
            };
        });
        // Calculate success rates
        const paymentSuccessRate = totalPayments > 0 ? (successfulPayments / totalPayments * 100).toFixed(2) : 0;
        const fileCompletionRate = totalFiles > 0 ? ((filesByStatus.completed || 0) / totalFiles * 100).toFixed(2) : 0;
        // OPTIMIZATION: Batch fetch agent performance data
        const agentPerformance = await Promise.all(agentsSnapshot.docs.map(async (agentDoc)=>{
            const agentData = agentDoc.data();
            const agentId = agentDoc.id;
            const agentFilesSnapshot = await withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('files').where('assignedAgentId', '==', agentId).get());
            const completedFiles = agentFilesSnapshot.docs.filter((doc)=>doc.data().status === 'completed').length;
            const pendingFiles = agentFilesSnapshot.docs.filter((doc)=>doc.data().status === 'paid' || doc.data().status === 'processing').length;
            return {
                id: agentId,
                name: agentData.name,
                email: agentData.email,
                totalFiles: agentFilesSnapshot.size,
                completedFiles,
                pendingFiles,
                completionRate: agentFilesSnapshot.size > 0 ? (completedFiles / agentFilesSnapshot.size * 100).toFixed(2) : 0
            };
        }));
        // Get daily statistics for charts
        const dailyStats = await getDailyStats(startDate, endDate).catch(()=>[]);
        const result = {
            success: true,
            period,
            overview: {
                totalUsers,
                activeUsers,
                newUsers,
                totalAgents,
                activeAgents,
                newAgents,
                totalFiles,
                newFiles,
                unassignedFiles,
                totalPayments,
                successfulPayments,
                newPayments,
                totalRevenue,
                newRevenue
            },
            files: {
                total: totalFiles,
                byStatus: filesByStatus,
                new: newFiles,
                unassigned: unassignedFiles,
                completionRate: fileCompletionRate
            },
            payments: {
                total: totalPayments,
                successful: successfulPayments,
                new: newPayments,
                totalRevenue,
                newRevenue,
                successRate: paymentSuccessRate
            },
            agents: {
                total: totalAgents,
                active: activeAgents,
                new: newAgents,
                performance: agentPerformance
            },
            activity: {
                recent: recentActivity,
                dailyStats
            }
        };
        // Cache the result for 2 minutes
        __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$server$2d$cache$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["serverCache"].set(cacheKey, result, 120_000); // 2 minutes
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(result);
    } catch (error) {
        console.error("Error fetching dashboard data:", error);
        // Handle specific error types
        if (error.code === 14 || error.message?.includes('No connection established')) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                message: "Database connection failed. Please try again."
            }, {
                status: 503
            });
        }
        if (error.name === 'AbortError' || error.message?.includes('timeout')) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                message: "Request timed out. Please try again."
            }, {
                status: 408
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            message: "Failed to fetch dashboard data"
        }, {
            status: 500
        });
    }
}
// Helper function to get daily statistics (OPTIMIZED)
async function getDailyStats(startDate, endDate) {
    const dailyData = {};
    // Initialize all days in range
    for(let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)){
        const dateKey = d.toISOString().split('T')[0];
        dailyData[dateKey] = {
            date: dateKey,
            files: 0,
            payments: 0,
            revenue: 0,
            users: 0
        };
    }
    try {
        // OPTIMIZED: Use limited queries with date filters
        const [filesSnapshot, paymentsSnapshot, usersSnapshot] = await Promise.all([
            // Files with date range limit
            withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('files').where('uploadedAt', '>=', startDate).where('uploadedAt', '<=', endDate).limit(1000).get()).catch(()=>({
                    docs: []
                })),
            // Payments with date range limit
            withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('payments').where('createdAt', '>=', startDate).where('createdAt', '<=', endDate).limit(1000).get()).catch(()=>({
                    docs: []
                })),
            // Users with date range limit
            withRetry(()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2d$app$2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["adminDb"].collection('users').where('role', '==', 'user').where('createdAt', '>=', startDate).where('createdAt', '<=', endDate).limit(500).get()).catch(()=>({
                    docs: []
                }))
        ]);
        // Process files
        filesSnapshot.docs.forEach((doc)=>{
            const uploadedAt = doc.data().uploadedAt?.toDate?.() || doc.data().uploadedAt;
            if (uploadedAt) {
                const dateKey = uploadedAt.toISOString().split('T')[0];
                if (dailyData[dateKey]) {
                    dailyData[dateKey].files++;
                }
            }
        });
        // Process payments
        paymentsSnapshot.docs.forEach((doc)=>{
            const createdAt = doc.data().createdAt?.toDate?.() || doc.data().createdAt;
            if (createdAt) {
                const dateKey = createdAt.toISOString().split('T')[0];
                if (dailyData[dateKey]) {
                    dailyData[dateKey].payments++;
                    if (doc.data().status === 'captured') {
                        dailyData[dateKey].revenue += doc.data().amount || 0;
                    }
                }
            }
        });
        // Process users
        usersSnapshot.docs.forEach((doc)=>{
            const createdAt = doc.data().createdAt?.toDate?.() || doc.data().createdAt;
            if (createdAt) {
                const dateKey = createdAt.toISOString().split('T')[0];
                if (dailyData[dateKey]) {
                    dailyData[dateKey].users++;
                }
            }
        });
    } catch (error) {
        console.error('Error fetching daily stats:', error);
    // Return empty data if there's an error
    }
    return Object.values(dailyData).sort((a, b)=>a.date.localeCompare(b.date));
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__35fe9d01._.js.map